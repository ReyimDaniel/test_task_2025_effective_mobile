# Тестовое задание "Приложение создание постов" на FastAPI

## Что нужно сделать
1. ### Взаимодействие с пользователем
Позволяет пользователям регистрироваться, входить в систему, выходить из учетной записи, обновлять свои данные и удалять аккаунт.
- Регистрация: Ввод имени (фамилии, отчества), email, пароля, повтор па-роля.
- Обновление информации: Пользователь может редактировать свой профиль.
- Удаление пользователя: Удаление аккаунта (мягкое) — пользователь инициирует удаление, происходит logout, пользователь больше не может залогиниться, но при этом в базе учетная запись остается со статусом is_active=False.
- Login: пользователь входить в систему по email и паролю.
- Logout: пользователь выходит из системы.
- После login система при последующих обращениях должна идентифицировать пользователя.

2. ### Система разграничения прав доступа. 
- Необходимо продумать и в текстовом файле или в REAME.md описать схему структуры управления ограничениями доступа.
- Реализованы соответствующие таблицы в БД.
- Таблицы заполнены тестовыми данными для минимальной отработки приложения для демонстрации работающей системы.
- Если пользователь имеет доступ к ресурсу по вышеописанным правилам, ему выдается запрашиваемый ресурс. Если по входящему запросу не удается определить залогиненного пользователя, выдается ошибка 401. Если пользователь определен, но запрашиваемый ресурс ему не доступен 403 ошибка — Forbidden. 
- Реализовать API с возможностью получения и изменения этих правил пользователю, имеющему роль администратора.


3. ### Минимальные вымышленные объекты бизнес-приложения, к которым могла бы применяться созданная система.
Таблицы в БД создавать не требуется. Можно просто написать Mock-View, ко-торые по обращениям будут выдавать список потенциальных объектов или описанные выше ошибки.


## Реализовано:
- Все CRUD операции с моделями пользователей(user) и пост(post)
- Оформлено описания CRUD-операций в Swagger Documentation
- JWT авторизация *(шифрование паролей через bcrypt)*
- Подключена база данных PostgresSQL
- Небольшой веб-интерфейс
- Ветка main: Приложение развернуто на [хосте](https://test-task-2025-effective-mobile.onrender.com/) 

## Стек:
- Python 3.11
- fastapi 0.116.2
- SQLAlchemy 2.0.43
- Alembic 1.16.5
- Jinja2 3.1.6
- bcrypt 4.0.1
***Подробнее о всех библиотеках и фреймворках в файле requirements.txt***

## Таблицы

Таблица users
| Поле         | Тип              | Описание                                                   |
| ------------ | ---------------- | ---------------------------------------------------------- |
| `id`         | SERIAL (PK)      | Уникальный идентификатор пользователя                      |
| `username`   | VARCHAR          | Имя пользователя                                           |
| `email`      | VARCHAR (unique) | Почта пользователя (логин)                                 |
| `password`   | VARCHAR (hash)   | Хэшированный пароль                                        |
| `role`       | ENUM             | Роль (`Пользователь`, `Администратор`, `Модератор`, `ВИП`) |
| `is_active`  | BOOLEAN          | Статус активности (false при удалении)                     |
| `access_id`  | INT (FK)         | Уровень доступа (ссылка на `entry_accesses.id`)            |
| `created_at` | TIMESTAMP        | Дата создания                                              |
| `updated_at` | TIMESTAMP        | Дата последнего обновления                                 |

\
Таблица posts
| Поле                 | Тип         | Описание                       |
| -------------------- | ----------- | ------------------------------ |
| `id`                 | SERIAL (PK) | Уникальный идентификатор поста |
| `title`              | VARCHAR     | Заголовок поста                |
| `description`        | TEXT        | Содержимое поста               |
| `required_access_id` | INT (FK)    | Минимальный уровень доступа    |
| `owner_id`           | INT (FK)    | Автор поста (`users.id`)       |
| `created_at`         | TIMESTAMP   | Дата создания                  |
| `updated_at`         | TIMESTAMP   | Дата последнего обновления     |  

\
Таблица entry_accesses
| Поле           | Тип         | Описание                                                     |
| -------------- | ----------- | ------------------------------------------------------------ |
| `id`           | SERIAL (PK) | Уровень доступа (1 — минимальный, 3 — макс.)                 |
| `access_title` | VARCHAR     | Название уровня (`default_role`, `premium_role`, `vip_role`) |
| `description`  | TEXT        | Описание роли                                                |

## Связи
- users.access_id → entry_accesses.id (многие к одному)
- posts.owner_id → users.id (многие к одному)
- posts.required_access_id → entry_accesses.id (многие к одному)  


## Запуск приложения
## Локальный запуск из PyCharm.
***Ветка: local_branch***  
1. **Для работы приложения необходимо запустить файл generate_certs.py - генерация пары ключей для шифрования паролей в базе данных.**  
2. **Необходимо настроить DB_URL в файле .env**  
***В проекте создан файл-пример .env.example***  
3. **После генерации необходимо запустить main.py файл - Запустится *[локальный сервер](http://localhost:8000)*, URL которого необходимо открыть в браузере.**

## Запуск из Docker
**Реализован Docker контейнер. Для его использования необходим установленный и запущенный Docker Desktop. В корне проекта ввести команды:**  
```docker build -t fastapi_project .```  
```docker run -d -p 8000:8000 --name test_task_app fastapi_project```  
**После ввода команд появится и запустится Docker-контейнер с приложением. Оно будет доступно по адресу *[локального сервера](http://localhost:8000)*.**  

## Ветка main
***Ветка на которой развернут проект.***


### Адреса
***Развернутое приложение: https://test-task-2025-effective-mobile.onrender.com/***  
***Локальный сервер: http://localhost:8000***  
***Swagger-документация: http://localhost:8000/docs***

## Приложение
***Разработанный проект позволяет регистрироваться и авторизоваться через логин(почта) и пароль. Обновлять данные пользователя, производить мягкое удаление(аккаунт станивотся is_active=False). После авторизации приложение позволяет создавать новые посты, редактировать и удалять созданные.***  
